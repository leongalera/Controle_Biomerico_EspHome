{% extends "base.html" %}

{% block title %}Administração do Sistema{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1><i class="bi bi-shield-lock"></i> Administração do Sistema</h1>
</div>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-person-badge"></i> Gerenciar Administradores</h5>
            </div>
            <div class="card-body">
                <p>Adicione, edite ou remova usuários com acesso a este painel de controle.</p>
                <a href="{{ url_for('admin.list_admins') }}" class="btn btn-primary">Gerenciar Admins</a>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-eraser-fill"></i> Limpar Digitais por Zona</h5>
            </div>
            <div class="card-body">
                <p>Apague TODAS as digitais de um módulo ESP32 específico e do banco de dados.</p>
                {% for zone in zones %}
                <form action="{{ url_for('zone.delete_all_fingerprints', zone_id=zone.id) }}" method="POST" class="d-inline" onsubmit="return confirm('ATENÇÃO! Esta ação é irreversível e apagará TODAS as digitais do módulo {{ zone.name }} e do sistema. Deseja continuar?');">
                    <button type="submit" class="btn btn-warning mb-2">
                        Limpar Zona: {{ zone.name }}
                    </button>
                </form>
                {% else %}
                <p class="text-muted">Nenhuma zona cadastrada.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5><i class="bi bi-exclamation-octagon-fill"></i> Área de Perigo</h5>
            </div>
            <div class="card-body">
                <h5 class="card-title text-danger">Zerar Ferramenta (Factory Reset)</h5>
                <p class="card-text">
                    Esta ação é irreversível e apagará <strong>TODOS OS DADOS</strong> do sistema, incluindo:
                    <ul>
                        <li>Todos os usuários e suas digitais</li>
                        <li>Todas as zonas, grupos, senhas e tags RFID</li>
                        <li>Todos os logs de acesso</li>
                        <li><strong>Todos os usuários administradores (incluindo o seu)</strong></li>
                    </ul>
                    Após esta ação, você será desconectado e precisará definir um novo administrador na tela de configuração do Add-on no Home Assistant e reiniciá-lo.
                </p>
                <form action="{{ url_for('admin.factory_reset') }}" method="POST" onsubmit="return confirm('VOCÊ TEM CERTEZA ABSOLUTA? Esta ação não pode ser desfeita e todos os dados serão perdidos permanentemente.');">
                    <button type="submit" class="btn btn-danger">Zerar a Ferramenta Agora</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}